---
title: "Problem2"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(plotly)
library(tidyverse)
library(p8105.datasets)
```

Column {data-width=650}
-----------------------------------------------------------------------

```{r}
# First, I remove all the rows contain NA
rest_inspec_clean<- 
  rest_inspec%>%
  drop_na()


```


```{r}
Top10<-rest_inspec_clean%>%
  filter(boro == "MANHATTAN")%>%
  group_by(cuisine_description)%>%
  summarize(n = n())%>%
  arrange(desc(n))%>%
  head(10)

Top10_names<-pull(Top10,cuisine_description)

```





### Chart A

```{r}
#不同菜系分数和得分的箱体图
rest_inspec_clean%>%
  filter(boro == "MANHATTAN")%>%
  filter(cuisine_description %in% Top10_names)%>%
  mutate(cuisine_description = case_when(
    cuisine_description == "Latin (Cuban, Dominican, Puerto Rican, South & Central American)" ~ "Latin",
    TRUE ~ cuisine_description
  ))%>%
  mutate(cuisine_description = as.factor(cuisine_description)) %>%
  mutate(cuisine_description = fct_reorder(cuisine_description, score)) %>%
  plot_ly(
    x = ~cuisine_description, y = ~score, type = "box", 
    color = ~cuisine_description, alpha = 0.5)
  
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
rest_inspec_clean%>%
  #filter(boro == "MANHATTAN")%>%
  mutate(time = as.Date(grade_date))%>%
  mutate(month = str_replace(time,"\\-[0-9][0-9]\\-[0-9][0-9]$",""))%>%
  filter(cuisine_description %in% Top10_names)%>%
  mutate(cuisine_description = case_when(
    cuisine_description == "Latin (Cuban, Dominican, Puerto Rican, South & Central American)" ~ "Latin",
    TRUE ~ cuisine_description
  ))%>%
  group_by(cuisine_description,month)%>%
  summarise(A_percentage = sum(grade == "A") / n())%>%
  plot_ly(
    x = ~month, y = ~A_percentage, color = ~cuisine_description, type = "scatter",mode = "lines", alpha = 0.5)

```

### Chart C

```{r}
rest_inspec_clean%>%
  filter(boro == "MANHATTAN")%>%
  group_by(zipcode)%>%
  summarise(A_num= sum(grade == "A"))%>%
  mutate(zipcode = as.factor(zipcode))%>%
  #arrange(A_percentage)%>%
  mutate(zipcode = fct_reorder(zipcode, A_num)) %>%
  plot_ly(
    x = ~as.factor(zipcode), y = ~A_num, color = ~zipcode,colors = "viridis", type = "bar", alpha = 0.5)
```

```{r}
rest_inspec_clean%>%
  filter(boro == "MANHATTAN")%>%
  group_by(zipcode)%>%
  summarise(A_percentage = sum(grade == "A"))%>%
  arrange(A_percentage)
```


